---
layout: posts
title: BlueTooth Low Energy 
author: huntershuai
---

BlueTooth Low Energy
=====
This blog is used to conclude the BLE main knowleadge point in my working life.


##Bluetooth Core System Architecture
<img src=" /images/ble/bt_core_frame.jpg" width="500"></img>

<img src=" /images/ble/transport_arch.jpg" width="500"></img>

##BLE PHY 

* LE data channel number is possible 37, index at 0~36

* advertisign channel 3, index at 37,38, 39

* frequency point: 2402~2480MHz  bandwidth=2MHz

<img src=" /images/ble/phy_channel.jpg" width="500"></img>

###broadcast channel

* advertiser

  	transimit advertising packet

* scanner

   	receiving advertising packet but don't intension to establish connection

* initiator
	
	listen advertising packet and intend to initialize an link

###Physical link

* LE active physical link 
* LE advertising physical link 



##Logic transport
###BLE Roles & message exchange procedure
<img src=" /images/ble/roles_procedure.png" width="500"></img>


###SMP procedure analysis
Defines the protocol and behavior to manage pairing, authentication and encryption between LE devices.

- Authentication and key management
- AES-128
- Secure link

2 kind of pairing mode:

- just work
- passkey entry

###L2CAP analysis


###BLE packet format
<img src=" /images/ble/ble_packet.png" width="500"></img>


HCI Header: Handle (2Bytes) + Length (2Bytes)

L2CAP Header: PDU Length (2 Bytes) + CID(2Bytes)

ATT Data: Opcode (1Byte) + Data(variable)

###














